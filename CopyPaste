CREATE SCHEMA IF NOT EXISTS `Caesb` DEFAULT CHARACTER SET utf8;
USE `Caesb`;

CREATE TABLE IF NOT EXISTS `TipoTarifa`(
`idtipotarifa` INT NOT NULL,
`desctipotarifa` VARCHAR(45) NOT NULL,
PRIMARY KEY(idtipotarifa)
);
CREATE TABLE IF NOT EXISTS `UnidadeConsumo`(
`idunidadeconsumo` INT NOT NULL,
`matricula` VARCHAR(11) NOT NULL,
`endereco` VARCHAR(45) NOT NULL,
`idtipotarifa` INT NOT NULL,
PRIMARY KEY(idunidadeconsumo),
FOREIGN KEY(idtipotarifa) REFERENCES TipoTarifa(idtipotarifa)
);
CREATE TABLE IF NOT EXISTS `Consumo`(
`idconsumo` INT NOT NULL,
`quantidade` FLOAT NOT NULL,
`mes` INT NOT NULL,
`ano` INT NOT NULL,
`idunidadeconsumo` INT NOT NULL,
PRIMARY KEY(idconsumo),
FOREIGN KEY(idunidadeconsumo) REFERENCES UnidadeConsumo(idunidadeconsumo)
) ENGINE = InnoDB;

INSERT INTO TipoTarifa VALUES (1, 'Normal');
INSERT INTO TipoTarifa VALUES (2, 'Reduzida');

SELECT * FROM `TipoTarifa`;

INSERT INTO UnidadeConsumo VALUES (1, 1, 'Avenida Brasil', 1);
INSERT INTO UnidadeConsumo VALUES (2, 2, 'Avenida Argentina', 1);
INSERT INTO UnidadeConsumo VALUES (3, 3, 'Avenida Paraguai', 2);
INSERT INTO UnidadeConsumo VALUES (4, 4, 'Avenida Chile', 1);

SELECT * FROM `UnidadeConsumo`;

INSERT INTO `Consumo` VALUES (1, 30, 3, 2019, 1);
INSERT INTO `Consumo` VALUES (2, 39, 3, 2019, 2);
INSERT INTO `Consumo` VALUES (3, 50, 3, 2019, 3);
INSERT INTO `Consumo` VALUES (4, 30, 4, 2019, 4);

SELECT * FROM `Consumo`;

SELECT COUNT(`matricula`) FROM `UnidadeConsumo`, `TipoTarifa`, `Consumo` WHERE `TipoTarifa`.`idtipotarifa` = `UnidadeConsumo`.`idtipotarifa` AND `Consumo`.`idunidadeconsumo` = `UnidadeConsumo`.`idunidadeconsumo` AND `Consumo`.`ano` = "2019" AND `Consumo`.`mes` = "3" AND `Consumo`.`quantidade` < 40 AND `desctipotarifa` = 'Normal';

hj
